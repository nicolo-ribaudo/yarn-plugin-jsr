/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-jsr",
factory: function (require) {
var plugin=(()=>{var _=Object.create;var y=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var p=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')});var H=(s,e)=>{for(var t in e)y(s,t,{get:e[t],enumerable:!0})},M=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of A(e))!N.call(s,o)&&o!==t&&y(s,o,{get:()=>e[o],enumerable:!(r=B(e,o))||r.enumerable});return s};var J=(s,e,t)=>(t=s!=null?_(I(s)):{},M(e||!s||!s.__esModule?y(t,"default",{value:s,enumerable:!0}):t,s)),z=s=>M(y({},"__esModule",{value:!0}),s);var G=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var L=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)};var O=(s,e,t)=>(G(s,e,"access private method"),t);var K={};H(K,{default:()=>q});var D=p("@yarnpkg/core");var w="jsr:",l=s=>s.startsWith(w),i=s=>s.slice(w.length);var v=class{supportsDescriptor(e){return l(e.range)&&!!D.structUtils.tryParseDescriptor(i(e.range),!0)}supportsLocator(e){return!1}shouldPersistResolution(){throw new Error("Unreachable")}bindDescriptor(e){return e}#e(e,t){let r=D.structUtils.parseDescriptor(i(e.range),!0);return r.range=`jsr:${r.range}`,t.configuration.normalizeDependency(r)}getResolutionDependencies(e,t){return t.resolver.getResolutionDependencies(this.#e(e,t.project),t)}async getCandidates(e,t,r){return await r.resolver.getCandidates(this.#e(e,r.project),t,r)}async getSatisfying(e,t,r,o){return o.resolver.getSatisfying(this.#e(e,o.project),t,r,o)}async resolve(e,t){throw new Error("Unreachable")}};var g=p("@yarnpkg/core"),d=J(p("semver"));var W="http://jsr.io/",Y="http://npm.jsr.io/";function x(s){let e=new Map;return(...t)=>{let r=t.join(",");if(e.has(r))return e.get(r);let o=s(...t);return e.set(r,o),o.catch(()=>e.delete(r)),o}}var Z=x(async function(e,t){let r=await fetch(`${W}/@${e}/${t}/meta.json`);if(!r.ok)throw r.status===404?new Error(`${t} does not exist on from JSR`):new Error(`Failed to fetch ${t} metadata from JSR`);return await r.json()});async function R(s,e){let t=[],r=[],o=await Z(s,e);for(let[a,n]of Object.entries(o.versions))(n.yanked?r:t).push(a);if(e==="http")debugger;return{valid:t,yanked:r}}var b=x(async function(e,t){let r=await fetch(`${Y}/@jsr/${e}__${t}`);if(!r.ok)throw new Error(`Failed to fetch ${t} npm metadata from JSR`);return await r.json()});var k=class{supportsDescriptor(e){return l(e.range)&&!!d.validRange(i(e.range))}supportsLocator(e){return l(e.reference)}shouldPersistResolution(){return!0}bindDescriptor(e){return e}getResolutionDependencies(){return{}}async getCandidates(e){if(!e.scope)throw new Error("jsr packages are scoped: @???/"+e.name);let t=new d.Range(i(e.range)),r=await R(e.scope,e.name),o=r.valid.map(a=>new d.SemVer(a)).filter(a=>t.test(a));return o.length===0&&(o=r.yanked.map(a=>new d.SemVer(a)).filter(a=>t.test(a))),o.sort((a,n)=>-a.compare(n)),o.map(a=>g.structUtils.makeLocator(e,`${w}${a.raw}`))}async getSatisfying(e,t,r,o){throw new Error("Not implemented")}async resolve(e,t){let r=i(e.reference),a=(await b(e.scope,e.name)).versions[r],n=new Map;for(let[h,u]of Object.entries(a.dependencies)){let C=g.structUtils.parseIdent(h);if(h.startsWith("@jsr/")){let[E,V]=h.slice(5).split("__");u=`jsr:@${E}/${V}@${u}`}else u=`npm:${u}`;let $=g.structUtils.makeDescriptor(C,u);n.set($.identHash,$)}return{...e,version:r,languageName:"node",linkType:g.LinkType.HARD,bin:new Map,dependencies:n,dependenciesMeta:new Map,peerDependencies:new Map,peerDependenciesMeta:new Map}}};var f=p("@yarnpkg/core");var P=class{supports(e){return l(e.reference)}getLocalPath(e,t){return null}async fetch(e,t){let r=t.checksums.get(e.locatorHash)||null,[o,a,n]=await t.cache.fetchPackageFromCache(e,r,{onHit(){t.report.reportCacheHit(e)},onMiss(){t.report.reportCacheMiss(e,`${f.structUtils.prettyLocator(t.project.configuration,e)} can't be found in the cache and will be fetched from the remote registry`)},loader:()=>this.#e(e,t),...t.cacheOptions});return{packageFs:o,releaseFs:a,prefixPath:f.structUtils.getIdentVendorPath(e),checksum:n}}async#e(e,t){let r=await fetch(`https://npm.jsr.io/~/5/@jsr/${e.scope}__${e.name}/${i(e.reference)}.tgz`);if(!r.ok)throw new Error(`Failed to fetch @${e.scope}/${e.name} tarball from jsr`);return await f.tgzUtils.convertToZip(Buffer.from(await r.arrayBuffer()),{configuration:t.project.configuration,prefixPath:f.structUtils.getIdentVendorPath(e),stripComponents:1})}};var S=p("@yarnpkg/cli"),U=p("@yarnpkg/core"),c=p("clipanion");var j,T,m=class extends S.BaseCommand{constructor(){super(...arguments);L(this,j);this.exact=c.Option.Boolean("-E,--exact",!1,{description:"Don't use any semver modifier on the resolved range"});this.tilde=c.Option.Boolean("-T,--tilde",!1,{description:"Use the `~` semver modifier on the resolved range"});this.caret=c.Option.Boolean("-C,--caret",!1,{description:"Use the `^` semver modifier on the resolved range"});this.dev=c.Option.Boolean("-D,--dev",!1,{description:"Add a package as a dev dependency"});this.peer=c.Option.Boolean("-P,--peer",!1,{description:"Add a package as a peer dependency"});this.packages=c.Option.Rest()}async execute(){let t=await Promise.all(this.packages.map(r=>O(this,j,T).call(this,r)));return this.cli.run(["add",this.exact&&"--exact",this.tilde&&"--tilde",this.caret&&"--caret",this.dev&&"--dev",this.peer&&"--peer",...t].filter(Boolean))}};j=new WeakSet,T=async function(t){if(t.includes("@",1))return t;let{scope:r,name:o}=U.structUtils.parseIdent(t);if(!r)throw new Error(`jsr packages are scoped: ${t}`);let a=await R(r,o),n=a.valid.length>0?a.valid[0]:a.yanked[0],h=this.exact?"":this.tilde?"~":"^";return`${t}@jsr:${h}${n}`},m.paths=[["jsr","add"]],m.usage=c.Command.Usage({description:"add JSR dependencies to the project",details:`
      This command adds a package to the package.json from the JSR registry.
    `,examples:[["Add a JSR package","$0 jsx add @luca/flag"],["Add a specific version range of a JSR package","$0 jsr add @luca/flag@^0.1.0"]]});var q={resolvers:[v,k],fetchers:[P],commands:[m]};return z(K);})();
return plugin;
}
};
